\documentclass[12pt]{article}
\usepackage[letterpaper,left=4.9cm,right=1.9cm,top=3.1cm,bottom=2.3cm]{geometry} % Márgenes y demás
\usepackage[nswissgerman]{babel}
\usepackage{siunitx}
\usepackage[table]{xcolor}
\usepackage{dirtree}
\usepackage{pythonhighlight}
\input{Styles_ACCEFN.sty}  

\setlength{\topskip}{0.5cm}
\setlength{\parindent}{0mm}

%\title{\fontsize{14}{14}\textbf{Sleep Cube - Diary} \\[0.2cm]

\title{\textcolor{gray}{\textbf{sleepCube - Programming Document}\\[0.2cm]}}



\author[1]{\fontsize{9}{9} \textbf{Ugur Turhal}}
%\author[2]{\textbf{Silvan Lenzlinger}}
%\author[1]{\textbf{Berkan Kurt}}

\affil[1]{\fontsize{8}{8}\href{mailto:ugur.turhal@me.com}{ugur.turhal@me.com}}
\date{\today}                     
\setcounter{Maxaffil}{0}

\usepackage{listings,newtxtt}

\lstset{basicstyle=\ttfamily, keywordstyle=\bfseries}    

\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.47,0.47,0.33}
\definecolor{myorange}{rgb}{0.8,0.4,0}
\definecolor{mywhite}{rgb}{0.98,0.98,0.98}
\definecolor{myblue}{rgb}{0.01,0.61,0.98}

\lstnewenvironment{code}{\lstset{ %
  backgroundcolor=\color{mywhite},   
  basicstyle=\footnotesize,       
  breakatwhitespace=false,         
  breaklines=true,                 
  captionpos=b,                   
  commentstyle=\color{mygray},    
  deletekeywords={...},           
  escapeinside={\%*}{*)},          
  extendedchars=true,              
  frame=shadowbox,                    
  keepspaces=true,                 
  keywordstyle=\color{myorange},       
  language=C++,                
  morekeywords={*,...},            
  numbers=left,                    
  numbersep=5pt,                   
  numberstyle=\tiny\color{mygray}, 
  rulecolor=\color{black},         
  rulesepcolor=\color{myblue},
  showspaces=false,                
  showstringspaces=false,          
  showtabs=false,                  
  stepnumber=2,                    
  stringstyle=\color{myorange},    
  tabsize=2,                       
  title=\lstname                   
}}{}

\DeclareSIUnit \volt{V} %apparent power 
\begin{document}
\maketitle
\tableofcontents
\addtocontents{toc}{\protect\thispagestyle{empty}}
\newpage
\setcounter{page}{1}
\section{DHT22}
\justifying
Der Sensor ist ein DHT22, welcher wie folgt aus sieht. Mit diesem wird die Umgebungstemperatur gemessen. Der DHT22 hat 4 Pins siehe Bild \ref{Fig:description}. Dessen Erläuterung ist in der Tabelle\ref{Tabular:pins}.
\begin{figure}[H]
\begin{center}
\includegraphics[width = 0.25\textwidth]{pics/DHT22.jpg}
\caption{DHT22 - Pins}
\label{Fig:description}
\end{center}
\end{figure}
\subsection{Pins und deren Bedeutung}
\begin{table}[H]
\centering
\rowcolors{2}{purple!30}{pink!60}
\begin{tabular}{l|l}
\textbf{Pin} & \textbf{Funktion}\\ \hline \hline
1 & Betriebsspannung (3,3V - 5,5V) \\ \hline
2 & Serial Data Line\\\hline
3 & Nicht belegt\\ \hline
4 & Ground
\end{tabular}
\caption{Pins - Bedeutung}
\label{Tabular:pins}
\end{table}
%\footnote{https://elektro.turanis.de/html/prj042/index.html}
\subsection{Verkabelung}
\begin{figure}[H]
\begin{center}
\includegraphics[width=0.5\textwidth]{pics/wireddht.png}
\caption{Temperaturausgaben über eine bestimme Zeit}
\includegraphics[width=0.5\textwidth]{pics/schematic.png}
\caption{Temperaturausgaben über eine bestimme Zeit}
\end{center}
\end{figure}
\section{DHT22 - Arduino}
\justifying
Installiere die DHT sensor library in die Arduino IDE:
\begin{figure}[H]
\DTsetlength{0.2em}{2.5em}{0.2em}{0.4pt}{2.6pt}
\dirtree{%
.1 /.
.2 Tools.
.3 Manage Libraries$\dots$ .
.4 Mangae Library.
.5 \textit{Filter your Search}.
.6 DHT22.
.6 \textbf{DHT22 sensor library}\\ by Adafruit Version 1.4.3.
}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
DHT22 ist bereit zum Einsatz.

\subsection{Arduino Code}
\begin{code}
#include "DHT.h"

#define DHTPIN 2 //Pin Nummer wo der Sensor angeschlossen ist
#define DHTTYPE DHT22 //Definition was fuer ein Sensor ausgelesen wird.

DHT dht(DHTPIN, DHTTYPE);

void setup() {
  // put your setup code here, to run once:
  Serial.begin(9600);
  //Serial.println("DHT22 Testprogramm");
  dht.begin();

}

void loop() {
  delay(2000);                     
                                    
  float h = dht.readHumidity();    
  float t = dht.readTemperature();
  
  if (isnan(h) || isnan(t)) {       
    Serial.println("Fehler beim auslesen des Sensors!");
    return;
  }

                   
  Serial.print(h);                 
  Serial.print(" ");                          
  Serial.println(t);
}
\end{code}
\newpage
\subsection{Python and Arduino}\footnote{}
Zwei kleine Python Programme wurden geschrieben um Daten aufzunehmen und zu visualisieren.
\begin{python}[language=Python]
import serial
import time
import csv
import matplotlib
matplotlib.use("tkAgg")
import matplotlib.pyplot as plt
import numpy as np

ser = serial.Serial('/dev/ttyACM0')
ser.flushInput()

plot_window = 360
y_var = np.array(np.zeros([plot_window]))

plt.ion()
fig, ax = plt.subplots()
ax.grid(linestyle="--")
ax.set_ylabel("Celsius")
ax.set_xlabel("x")
ax.set(xlabel ='x', ylabel ='Celsius',
       title ='Increase & Decrease of \n Temperature')
line, = ax.plot(y_var)

while True:
    try:
        ser_bytes = ser.readline()
        try:
            decoded_bytes = float(ser_bytes[5:len(ser_bytes)-2].decode("utf-8"))
            print(decoded_bytes)
        except:
            continue
        with open("test_data.csv","a") as f:
            writer = csv.writer(f,delimiter=",")
            writer.writerow([time.time(),decoded_bytes])
        y_var = np.append(y_var,decoded_bytes)
        y_var = y_var[1:plot_window+1]
        line.set_ydata(y_var)
        ax.relim()
        ax.autoscale_view()
        fig.canvas.draw()
        fig.canvas.flush_events()
        fig.savefig('full_figure.png')
    except:
        print("Keyboard Interrupt")
        break
\end{python}
\newpage
\begin{python}
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

plt.style.use('seaborn')


def main():
    df = pd.read_csv("groupeddata.csv", usecols=['Measurement', 'Temperature']).drop_duplicates(keep='first').reset_index()
    measurement = df['Measurement']
    temperature = df['Temperature']
    df.to_csv("cleanData.csv");
    colors = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90]

    plt.scatter(x=measurement, y=temperature, s=25, c=colors, alpha=0.6, edgecolor='black', linewidth=1,
                    cmap='Blues_r')

    cbar = plt.colorbar()
    cbar.set_label('Mesurements with Temperature')
    plt.xscale('log')
    plt.yscale('log')
    plt.title('Scatter of Temperature')
    plt.xlabel('Measurement')
    plt.ylabel('Temperature')

    #plt.tight_layout()
    plt.savefig("data.png")
    plt.show()


if __name__ == "__main__":
    print(main())

\end{python}
\subsection{Datenevaluation}
\begin{figure}[H]
\begin{center}
\includegraphics[width=0.7\textwidth]{pics/plot.png}
\caption{Temperaturausgaben über eine bestimme Zeit}
\includegraphics[width=0.7\textwidth]{pics/scatter.png}
\caption{Einzelne Messpunkte des DHT22}
\end{center}
\end{figure}
\newpage
\section{Simples Modell}
\begin{code}
#include "DHT.h"

#define DHTPIN 2 //Pin Nummer wo der Sensor angeschlossen ist
#define DHTTYPE DHT22 //Definition was fuer ein Sensor ausgelesen wird.
#define pinRed 4 // LEDPin4
#define pinGreen 5 //LEDPin5

DHT dht(DHTPIN, DHTTYPE);

void setup() {
  // put your setup code here, to run once:
  Serial.begin(9600);
  //Serial.println("DHT22 Testprogramm");
  pinMode(pinRed, OUTPUT);
  pinMode(pinGreen, OUTPUT);

  dht.begin();

}

void loop() {
  delay(2000);

  float h = dht.readHumidity();
  float t = dht.readTemperature();

  if (isnan(h) || isnan(t)) {
    Serial.println("Fehler beim auslesen des Sensors!");
    return;
  }

  if (t >= 15.00 && t <= 18.00) {
    digitalWrite(pinRed, LOW);
    digitalWrite(pinGreen, HIGH);
  }
  else  {
    digitalWrite(pinGreen,LOW);
    digitalWrite(pinRed, HIGH);
    
  }
   
   Serial.print(digitalRead(pinRed));
   Serial.print(" ");
   Serial.print(digitalRead(pinGreen));
   Serial.print(" ");
   Serial.println(t);

}
\end{code}
\begin{figure}[H]
\begin{center}
\includegraphics[width=0.5\textwidth]{pics/dhtled.png}
\caption{Einzelne Messpunkte des DHT22}
\end{center}
\end{figure}

\begin{figure}[H]
\begin{center}
\includegraphics[width=0.7\textwidth]{pics/digitalRead.png}
\caption{Einzelne Messpunkte des DHT22}
\end{center}
\end{figure}
\end{document}
